<!DOCTYPE html><html lang="en"><head>
  <!-- so meta -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="HandheldFriendly" content="True">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="Z6yCtJdtAEJhoqcK8R36N2xR5ULTuk3G4NcUGqdTqyc">
  <meta name="specificfeeds-verification-code" content="wVuTRqQ9R0Ez1dk7HVKj">
  <meta name="description" content="JWT Authentication is becoming one of the most used authentication types in modern web applications or services. This article covers the JWT Authentication with a Symmetric Key in ASP.NET Core. In t">
<meta property="og:type" content="article">
<meta property="og:title" content="JWT Authentication with Symmetric Encryption in ASP.NET Core">
<meta property="og:url" content="https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/index.html">
<meta property="og:site_name" content="Eduard Stefanescu">
<meta property="og:description" content="JWT Authentication is becoming one of the most used authentication types in modern web applications or services. This article covers the JWT Authentication with a Symmetric Key in ASP.NET Core. In t">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://eduardstefanescu.dev/images/social-preview.jpg">
<meta property="article:published_time" content="2020-04-11T07:51:22.000Z">
<meta property="article:modified_time" content="2021-08-29T08:59:27.652Z">
<meta property="article:author" content="Eduard Stefanescu">
<meta property="article:tag" content="dotnetcore">
<meta property="article:tag" content="authentication">
<meta property="article:tag" content="asp">
<meta property="article:tag" content="encryption">
<meta property="article:tag" content="symmetric">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://eduardstefanescu.dev/images/social-preview.jpg">
<meta name="twitter:creator" content="@1365233619720151040">
<meta name="twitter:site" content="https://eduardstefanescu.dev/">
  
  
  
  
  <link rel="shortcut icon" href="/images/favicon.ico">
  
  
  
  
  <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
  
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  
  
  
  <!-- title -->
  <title>JWT Authentication with Symmetric Encryption in ASP.NET Core</title>
  <!-- styles -->
  
<link rel="stylesheet" href="/css/style.css">

  <!-- persian styles -->
  
  
<link rel="stylesheet" href="/css/rtl.css">

  
  <!-- rss -->
  
  
  <link rel="alternate" href="/feed.xml" title="Eduard Stefanescu" type="application/atom+xml">
  
<meta name="generator" content="Hexo 6.0.0"></head>

  <body class="max-width mx-auto px3 ltr">
    <div class="container">
      
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/tags/notes/">Notes</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Archive</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/newsletter/">Newsletter</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2020/04/25/jwt-authentication-with-asymmetric-encryption-in-asp-dotnet-core/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2020/04/04/rabbitmq-consumer-events-with-docker-in-dotnet/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/&amp;text=JWT Authentication with Symmetric Encryption in ASP.NET Core"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/&amp;title=JWT Authentication with Symmetric Encryption in ASP.NET Core"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/&amp;is_video=false&amp;description=JWT Authentication with Symmetric Encryption in ASP.NET Core"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=JWT Authentication with Symmetric Encryption in ASP.NET Core&amp;body=Check out this article: https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/&amp;title=JWT Authentication with Symmetric Encryption in ASP.NET Core"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/&amp;title=JWT Authentication with Symmetric Encryption in ASP.NET Core"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/&amp;title=JWT Authentication with Symmetric Encryption in ASP.NET Core"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/&amp;title=JWT Authentication with Symmetric Encryption in ASP.NET Core"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/&amp;name=JWT Authentication with Symmetric Encryption in ASP.NET Core&amp;description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/&amp;t=JWT Authentication with Symmetric Encryption in ASP.NET Core"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Symmetric-Key"><span class="toc-number">1.1.</span> <span class="toc-text">Symmetric Key</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Setup"><span class="toc-number">2.</span> <span class="toc-text">Setup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Creating-a-secret-key"><span class="toc-number">3.</span> <span class="toc-text">Creating a secret key</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Startup"><span class="toc-number">4.</span> <span class="toc-text">Startup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UserCredentials"><span class="toc-number">5.</span> <span class="toc-text">UserCredentials</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AuthenticationService"><span class="toc-number">6.</span> <span class="toc-text">AuthenticationService</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UserService"><span class="toc-number">7.</span> <span class="toc-text">UserService</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TokenService"><span class="toc-number">8.</span> <span class="toc-text">TokenService</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AuthenticationController"><span class="toc-number">9.</span> <span class="toc-text">AuthenticationController</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ValidationController"><span class="toc-number">10.</span> <span class="toc-text">ValidationController</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-result"><span class="toc-number">11.</span> <span class="toc-text">The result</span></a></li></ol>
    </div>
  </span>
</div>

      
      <div class="content index py4">
        
        <article class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        JWT Authentication with Symmetric Encryption in ASP.NET Core
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
        <span itemprop="name">Eduard Stefanescu</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-04-11T07:51:22.000Z" itemprop="datePublished">11-04-2020</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/asp/" rel="tag">asp</a>, <a class="tag-link-link" href="/tags/authentication/" rel="tag">authentication</a>, <a class="tag-link-link" href="/tags/dotnetcore/" rel="tag">dotnetcore</a>, <a class="tag-link-link" href="/tags/encryption/" rel="tag">encryption</a>, <a class="tag-link-link" href="/tags/symmetric/" rel="tag">symmetric</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <!-- markdownlint-disable MD033 -->

<p>JWT Authentication is becoming one of the most used authentication types in modern web applications or services. This article covers the JWT Authentication with a Symmetric Key in ASP.NET Core. In the first part, there will be a short introduction into what Symmetric Key represents and the second part contains the prerequisites for this project and the actual implementation of this authentication type.<br>This article is the first article from of series of two, the second one will contain the authentication with an Asymmetric Key using a certificate.</p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>JWT Token is a common way of creating access tokens that can contain several claims (e.g. Username, Roles). JWT Token means JSON (JavaScript Object Notation) Web Token. Every JWT Token has the following structure:</p>
<ul>
<li>Header, containing the encryption algorithm;</li>
<li>Payload, containing custom Claims, plus at least two required claims:<ul>
<li><code>exp</code> representing the expiration time when the Token will become unavailable;</li>
<li><code>iat</code> or Issued at Time, the time when the Token was created;<br>The times are formatted using the Unix Timestamp format (e.g. 1582784721).</li>
</ul>
</li>
<li>Signature, representing the encoded header, plus <code>a dot</code>, plus the encoded payload, plus a secret key. The concatenated result will be run through the encryption algorithm specified on the Header to validate the Token.</li>
</ul>
<p>If you want to read more about JWT Token, this comprehensive paper covers all the concepts: <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7519">https://tools.ietf.org/html/rfc7519</a>.</p>
<h3 id="Symmetric-Key"><a href="#Symmetric-Key" class="headerlink" title="Symmetric Key"></a>Symmetric Key</h3><p>The Symmetric Key is used both for signing and validation. For example, let’s say the John wants to share a secret with Jane, when the secret is told, John also tells Jane a password - the key - in order for the secret to be understood. In this way, John - the identity provider or the service - ensures that his secret is well kept by using the given password.</p>

    <div>
      <img src="symmetric-key.svg" alt="Symmetric Key" data-action="zoom" class="photozoom">
      
    </div>

<h2 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h2><p>ASP.NET Core 3.1 will be used for this project. Microsoft also offers a great package that provides all that is needed to create a JWT Token-based authentication. The package is called <code>Microsoft.AspNetCore.Authentication.JwtBearer</code>, this is the only package that the project needs, and can be found here: <a target="_blank" rel="noopener" href="https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.JwtBearer">https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.JwtBearer</a>.</p>
<h2 id="Creating-a-secret-key"><a href="#Creating-a-secret-key" class="headerlink" title="Creating a secret key"></a>Creating a secret key</h2><p>The signing and validation key will be a user secret key. ASP.NET provides the user secret key feature to store all the confidential data that doesn’t have to be committed or shared outside the user or developer environment. For the production or testing environments, the keys need to be store in a cloud vault, like Microsoft Azure offers through Key Vault - <a target="_blank" rel="noopener" href="https://azure.microsoft.com/en-us/services/key-vault/">https://azure.microsoft.com/en-us/services/key-vault/</a> -, but this will be a topic for another article.<br>Firstly, the project needs to be initiated for using user secrets, by running the following command in the project folder:</p>
<script src="https://gist.github.com/StefanescuEduard/95c685ba92b5068bd7fbfe970e32c0e4.js"></script>
<p>Then the user secret key is added, using the following command:</p>
<script src="https://gist.github.com/StefanescuEduard/de3edb36cecfc650b434206fd7c5eda4.js"></script>
<p>This command will add to the <code>secrets.json</code> file the <code>AppSettings:EncryptionKey</code> key with the value <code>POWERFULENCRYPTIONKEY</code>.<br>If there are multiple values for the <code>AppSettings</code> then this key can become more readable by using a JSON format like:</p>
<script src="https://gist.github.com/StefanescuEduard/809bec7d49bc807774bd7fc646a5f8c4.js"></script>
<p>The <code>POWERFULENCRYPTIONKEY</code> will be encoded in an array of bytes and then this binary will be Base64 encoded, this is required for both signing and validation.</p>
<h2 id="Startup"><a href="#Startup" class="headerlink" title="Startup"></a>Startup</h2><p>In the <code>ConfigureServices</code> method from the <code>Startup</code> class, the <code>AppSettings</code> section needs to be read. To read a type from the configuration file, a class must be created, so for the <code>AppSettings</code> section an equivalent class needs to exists, as is shown below. This class can be seen as a Data Transfer Object, which contains plain properties.</p>
<script src="https://gist.github.com/StefanescuEduard/4fc78f767647bb27f6dfacf2534f34a7.js"></script>
<p>After the section is read, the <code>EncryptionKey</code> needs to be converted into bytes.</p>
<script src="https://gist.github.com/StefanescuEduard/84b4039f2f5ff38bb154003eb093867c.js"></script>
<p>On <code>line 9</code> the <code>Authentication</code> service is added into the App container, this service is responsible, with the managing <code>Authentication</code> settings, like <code>IssuerSigningKey</code> or <code>LifeTimeValidation</code>.<br>For this step, an extension method is created called <code>AddAuthentication</code>, which receives the <code>service</code> and the <code>signingKey</code> converted earlier.<br>From <code>line 11</code> to <code>14</code>, the services are configured for the Dependency Injection, we will return to the implementation of these services in a moment.</p>
<p>Let’s return to the <code>AddAuthentication</code> method:</p>
<script src="https://gist.github.com/StefanescuEduard/001c342d1f1b6a52faf2aa0709cd1ecb.js"></script>
<p>The <code>authenticationOptions</code> need to configure the <code>Authenticate</code> and <code>Challenge</code> Schemes, in order to verify that the endpoint(s) which receives a JWT Token will go through the validation step, as is described below starting from <code>line 12</code>. The same Schema will be seen on the endpoints that use the <code>AuthorizeAttribute</code>.<br>Then the <code>JwtBearer</code> is added to the <code>Authentication</code> process, using the following properties:</p>
<ul>
<li><code>SaveToken</code> is self-explanatory. It’s used to persist the Token into a local storage. The token will be valid even if the service restarts, so its lifetime is different from the application;</li>
<li><code>ValidateAudience</code> and <code>ValidateIssuer</code> must be used for the service to skip or to validate the Audience or the Issuer. The Audience refers to the server or the Identity Provider, in this case our ASP.NET Service. And the <code>Issuer</code> refers to the client(s) that makes HTTP request(s). For the sake of this example, both are set <code>false</code>. Please note that even if you don’t want to validate the <code>Audience</code> or/and the <code>Issuer</code> these values must be set;</li>
<li><code>ValidateIssuerSigningKey</code> needs to be set to <code>true</code>, in order to validate the received Token;</li>
<li>For <code>IssuerSigningKey</code> will use the <code>SymmetricSecurityKey</code>, the same approach will be also used when the Token will be created.</li>
<li><code>LifeTimeValidator</code> is important if the generated <code>Token</code> has set an expiration time.</li>
</ul>
<p>All the JWT Bearer Options can be found on the Microsoft website: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.authentication.jwtbearer.jwtbeareroptions">https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.authentication.jwtbearer.jwtbeareroptions</a>.</p>
<p>The <code>LifeTimeValidator</code> handler is checking if the expiration date is greater than the current Date, as follows:</p>
<script src="https://gist.github.com/StefanescuEduard/9179957eaf0cc9765c02ccf9dc391637.js"></script>

<p>After the services were configured, the <code>Authentication</code> and <code>Authorization</code> middleware must be added to the App pipeline in the <code>Configure</code> method.</p>
<script src="https://gist.github.com/StefanescuEduard/3b7f8d14b342b24609d32d519976d391.js"></script>

<h2 id="UserCredentials"><a href="#UserCredentials" class="headerlink" title="UserCredentials"></a><code>UserCredentials</code></h2><p>User’s Credentials will be used as a Data Transfer Object, this class will be received on the authentication endpoint and sent to the <code>AuthenticationService</code>. It’s a plain class that contains only the <code>Username</code> and the <code>Password</code> of the user.</p>
<script src="https://gist.github.com/StefanescuEduard/221e8de96fe412ebf143346d02df389b.js"></script>

<h2 id="AuthenticationService"><a href="#AuthenticationService" class="headerlink" title="AuthenticationService"></a><code>AuthenticationService</code></h2><p>The <code>AuthenticationService</code> is used like a middleware which receives the <code>UserCredentials</code> from the <code>Controller</code>, validate them using the <code>UserService</code> and if the credentials are valid, it creates a Token using the <code>TokenService</code>. Both the <code>User</code> and <code>Token</code> services are injected on the constructor.</p>
<script src="https://gist.github.com/StefanescuEduard/fc8c8776b5b10c235d0ec90a03baddf3.js"></script>

<h2 id="UserService"><a href="#UserService" class="headerlink" title="UserService"></a><code>UserService</code></h2><p>For the sake of this example, the <code>UserService</code> contains a list of users created on the constructor. In a real-life scenario, this will be read from a storage or from a service.</p>
<script src="https://gist.github.com/StefanescuEduard/42b61657f6c727d39d2a988a88613b6f.js"></script>
<p>This is more like a <code>UserValidation</code> service, but to better illustrate that it also reads the users, the <code>UserService</code> name will be kept.</p>
<script src="https://gist.github.com/StefanescuEduard/75dd9668eab79fd03e2a0450819cef5b.js"></script>
<p>The <code>ValidateCredentials</code> method checks if the <code>username</code> and <code>password</code> pair exists, and if it doesn’t it will throw the <code>InvalidCredentialsException</code> which will be caught on the <code>Controller</code>.</p>
<h2 id="TokenService"><a href="#TokenService" class="headerlink" title="TokenService"></a><code>TokenService</code></h2><p><code>TokenService</code> is receiving on the constructor the <code>AppSettings</code>, which will be used on the <code>GetTokenDescriptor</code> method to set up the Token.</p>
<script src="https://gist.github.com/StefanescuEduard/f60ae2f42b5149c9c0042e8cc472f9e7.js"></script>

<p>The public <code>GetToken</code> method is used to get the token description, to create the Token and write it into a string, that will be returned to the calling service, in this case to the <code>AuthenticationService</code>.</p>
<script src="https://gist.github.com/StefanescuEduard/ec1cb7b8308868d491cd9d078715c253.js"></script>

<p>On the <code>GetTokenDescriptor</code> method, the token is constructed. In this method, the <code>ExpirationTime</code> and <code>SigningCredentials</code> are set. Because the Claims are not in the main focus of this article, I will create another one, in which I will explain how the Claims can be set on the Token and how they can be used.</p>
<script src="https://gist.github.com/StefanescuEduard/f38f48801ddaf2af33ce4804840f4de8.js"></script>
<p>All the Token Descriptors can be found on the Microsoft website: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/api/system.identitymodel.tokens.securitytokendescriptor">https://docs.microsoft.com/en-us/dotnet/api/system.identitymodel.tokens.securitytokendescriptor</a>.</p>
<h2 id="AuthenticationController"><a href="#AuthenticationController" class="headerlink" title="AuthenticationController"></a><code>AuthenticationController</code></h2><p>Now, all we have to do, is to create an <code>AuthenticationController</code> which receives the <code>UserCredentials</code> and uses the previously created <code>AuthenticationService</code>.<br>On the constructor the <code>AuthenticationService</code> is injected, to be used on the <code>Authentication</code> endpoint.</p>
<script src="https://gist.github.com/StefanescuEduard/c98a7bc5ad4142c939ad54334d8d8955.js"></script>
<p>The authentication endpoint accepts HTTP Post requests, receives the <code>UserCredentials</code> as previously mentioned and uses the <code>AuthenticationService</code> to authenticate and create the Token.</p>
<script src="https://gist.github.com/StefanescuEduard/2330ad06d6bd4c693095f76a29f81171.js"></script>
<p>If the credentials are valid, then the endpoint will return an <code>OK</code> HTTP Status code and the generated token. Otherwise, if the <code>InvalidCredentialsException</code> is thrown, the <code>Unauthorized</code> HTTP Status code is returned.</p>
<h2 id="ValidationController"><a href="#ValidationController" class="headerlink" title="ValidationController"></a><code>ValidationController</code></h2><p>The purpose of the <code>ValidationController</code> is to check that the signing process is working, in order to validate the Token.</p>
<script src="https://gist.github.com/StefanescuEduard/0469aa49ff0516acbd0d3c4ef8afec82.js"></script>
<p>You may notice that the <code>Validate</code> endpoint has the <code>AuthorizeAttribute</code> which has on its constructor the same <code>AuthenticationSchemes</code> as was set on the <code>Authentication</code> service.</p>
<h2 id="The-result"><a href="#The-result" class="headerlink" title="The result"></a>The result</h2><p>Firstly, the happy flow for the <code>AuthenticationController</code> is tested, so we’ll provide the correct combination of the username and password, in order to receive the token.</p>

    <div>
      <img src="happy-flow-authentication.png" alt="Happy flow authentication" data-action="zoom" class="photozoom">
      
    </div>
<p>Let’s test with credentials that are not correct, the response should be Unauthorized.</p>

    <div>
      <img src="unauthorized-authentication.png" alt="Unauthorized authentication" data-action="zoom" class="photozoom">
      
    </div>

<p>And secondly, the generated token needs to be tested using the <code>Validation</code> controller. The first test will be with the generated token, to see that the validation is passed.</p>

    <div>
      <img src="happy-flow-validation.png" alt="Happy flow validation" data-action="zoom" class="photozoom">
      
    </div>
<p>And the second test is when the wrong token is provided for validation.</p>

    <div>
      <img src="unauthorized-validation.png" alt="Unauthorized flow validation" data-action="zoom" class="photozoom">
      
    </div>

<hr>
<p>The source code from this article can be found on my GitHub account: <a target="_blank" rel="noopener" href="https://github.com/StefanescuEduard/JwtAuthentication">https://github.com/StefanescuEduard/JwtAuthentication</a>.</p>
<p>Thanks for reading this article, if you find it interesting please share it with your colleagues and friends. Or if you find something that can be improved please let me know.</p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
        <div id="footer-post-container">
  <div id="footer-post">
    <div id="nav-footer" style="display: none">
      <ul>
        
        <li><a href="/">Home</a></li>
        
        <li><a href="/tags/notes/">Notes</a></li>
        
        <li><a href="/about/">About</a></li>
        
        <li><a href="/archives/">Archive</a></li>
        
        <li><a href="/search/">Search</a></li>
        
        <li><a href="/newsletter/">Newsletter</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Symmetric-Key"><span class="toc-number">1.1.</span> <span class="toc-text">Symmetric Key</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Setup"><span class="toc-number">2.</span> <span class="toc-text">Setup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Creating-a-secret-key"><span class="toc-number">3.</span> <span class="toc-text">Creating a secret key</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Startup"><span class="toc-number">4.</span> <span class="toc-text">Startup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UserCredentials"><span class="toc-number">5.</span> <span class="toc-text">UserCredentials</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AuthenticationService"><span class="toc-number">6.</span> <span class="toc-text">AuthenticationService</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UserService"><span class="toc-number">7.</span> <span class="toc-text">UserService</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TokenService"><span class="toc-number">8.</span> <span class="toc-text">TokenService</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AuthenticationController"><span class="toc-number">9.</span> <span class="toc-text">AuthenticationController</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ValidationController"><span class="toc-number">10.</span> <span class="toc-text">ValidationController</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-result"><span class="toc-number">11.</span> <span class="toc-text">The result</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/&amp;text=JWT Authentication with Symmetric Encryption in ASP.NET Core"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/&amp;title=JWT Authentication with Symmetric Encryption in ASP.NET Core"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/&amp;is_video=false&amp;description=JWT Authentication with Symmetric Encryption in ASP.NET Core"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=JWT Authentication with Symmetric Encryption in ASP.NET Core&amp;body=Check out this article: https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/&amp;title=JWT Authentication with Symmetric Encryption in ASP.NET Core"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/&amp;title=JWT Authentication with Symmetric Encryption in ASP.NET Core"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/&amp;title=JWT Authentication with Symmetric Encryption in ASP.NET Core"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/&amp;title=JWT Authentication with Symmetric Encryption in ASP.NET Core"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/&amp;name=JWT Authentication with Symmetric Encryption in ASP.NET Core&amp;description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://stefanescueduard.github.io/2020/04/11/jwt-authentication-with-symmetric-encryption-in-asp-dotnet-core/&amp;t=JWT Authentication with Symmetric Encryption in ASP.NET Core"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
      <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
      <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
      <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>
<script type="text/javascript">
  function isTocAvailable() {
    var $headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");
    var $tocFooter = document.getElementById('toc-footer');
    if ($headers.length === 1) {
      $tocFooter.style.display = 'none';
    }

    console.log($headers);
  }
</script>
<script>isTocAvailable();</script>
        
        <footer id="footer">
  <div class="footer-left">
    Copyright © 2022 Eduard Stefanescu
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/tags/notes/">Notes</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Archive</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/newsletter/">Newsletter</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

      </div>
      <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


      <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'stefanescueduard';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


    </div>
  

  <script type="text/javascript">/**
 * Pure JavaScript implementation of zoom.js.
 *
 * Original preamble:
 * zoom.js - It's the best way to zoom an image
 * @version v0.0.2
 * @link https://github.com/fat/zoom.js
 * @license MIT
 *
 * This is a fork of the original zoom.js implementation by @fat.
 * Copyrights for the original project are held by @fat. All other copyright
 * for changes in the fork are held by Nishanth Shanmugham.
 *
 * Copyright (c) 2013 @fat
 * The MIT License. Copyright © 2016 Nishanth Shanmugham.
 */
!function(){"use strict";var t=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.i=function(t){return t},n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e,n){n.d(e,"a",function(){return i}),n.d(e,"b",function(){return o}),n.d(e,"c",function(){return r}),n.d(e,"d",function(){return a});var i=function(){return document.documentElement.clientWidth},o=function(){return document.documentElement.clientHeight},r=function(t){var e=t.getBoundingClientRect(),n=document.documentElement,i=window;return{top:e.top+i.pageYOffset-n.clientTop,left:e.left+i.pageXOffset-n.clientLeft}},a=function(t,e,n){t.addEventListener(e,function t(i){i.target.removeEventListener(e,t),n()})}},function(t,e,n){var i=n(2),o=n(0);n.d(e,"a",function(){return g});var r=null,a=-1,s=-1,c=function(t){document.body.classList.contains("zoom-overlay-open")||(t.metaKey||t.ctrlKey?window.open(t.target.getAttribute("data-original")||t.target.src,"_blank"):t.target.width>=n.i(o.a)()-80||(u(!0),(r=new i.a(t.target,80)).zoom(),l()))},u=function(t){null!=r&&(t?r.dispose():r.close(),d(),r=null)},l=function(){document.addEventListener("scroll",m),document.addEventListener("keyup",f),document.addEventListener("touchstart",h),document.addEventListener("click",v,!0)},d=function(){document.removeEventListener("scroll",m),document.removeEventListener("keyup",f),document.removeEventListener("touchstart",h),document.removeEventListener("click",v,!0)},m=function(){-1==a&&(a=window.pageYOffset),Math.abs(a-window.pageYOffset)>=40&&u()},f=function(t){27==t.keyCode&&u()},h=function(t){var e=t.touches[0];null!=e&&(s=e.pageY,t.target.addEventListener("touchmove",p))},p=function t(e){var n=e.touches[0];null!=n&&Math.abs(n.pageY-s)>10&&(u(),e.target.removeEventListener("touchmove",t))},v=function(){u()},g=Object.create(null);g.setup=function(t){t.addEventListener("click",c)}},function(n,i,o){var r=o(0),a=function t(n,i){e(this,t),this.w=n,this.h=i},s=function(){function n(t,i){e(this,n),this.img=t,this.preservedTransform=t.style.transform,this.wrap=null,this.caption=null,this.overlay=null,this.offset=i}return t(n,[{key:"forceRepaint",value:function(){this.img.offsetWidth}},{key:"zoom",value:function(){var t=new a(this.img.naturalWidth,this.img.naturalHeight);this.wrap=document.createElement("div"),this.wrap.classList.add("zoom-img-wrap"),this.img.parentNode.insertBefore(this.wrap,this.img),this.wrap.appendChild(this.img),this.img.classList.add("zoom-img"),this.img.setAttribute("data-action","zoom-out"),this.overlay=document.createElement("div"),this.overlay.classList.add("zoom-overlay"),this.caption=document.createElement("span"),this.caption.innerHTML=this.img.getAttribute("alt"),this.caption.classList.add("zoom-caption"),this.overlay.appendChild(this.caption),document.body.appendChild(this.overlay),this.forceRepaint();var e=this.calculateScale(t);this.forceRepaint(),this.animate(e),document.body.classList.add("zoom-overlay-open")}},{key:"calculateScale",value:function(t){var e=t.w/this.img.width,n=o.i(r.a)()-this.offset,i=o.i(r.b)()-this.offset,a=t.w/t.h,s=n/i;return t.w<n&&t.h<i?e:a<s?i/t.h*e:n/t.w*e}},{key:"animate",value:function(t){var e=o.i(r.c)(this.img),n=window.pageYOffset,i=o.i(r.a)()/2,a=n+o.i(r.b)()/2,s="scale("+t+")",c="translate3d("+(i-(e.left+this.img.width/2))+"px, "+(a-(e.top+this.img.height/2))+"px, 0px)";this.img.style.transform=s,this.wrap.style.transform=c}},{key:"dispose",value:function(){null!=this.wrap&&null!=this.wrap.parentNode&&(this.img.classList.remove("zoom-img"),this.img.setAttribute("data-action","zoom"),this.wrap.parentNode.insertBefore(this.img,this.wrap),this.wrap.parentNode.removeChild(this.wrap),document.body.removeChild(this.overlay),document.body.classList.remove("zoom-overlay-transitioning"))}},{key:"close",value:function(){var t=this;document.body.classList.add("zoom-overlay-transitioning"),this.img.style.transform=this.preservedTransform,0===this.img.style.length&&this.img.removeAttribute("style"),this.wrap.style.transform="none",o.i(r.d)(this.img,"transitionend",function(){t.dispose(),document.body.classList.remove("zoom-overlay-open")})}}]),n}();i.a=s},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(1);document.addEventListener("DOMContentLoaded",function(){for(var t=document.querySelectorAll("img[data-action='zoom']"),e=0;e<t.length;e++)i.a.setup(t[e])})}])}();</script><style>img[data-action=zoom]{cursor:pointer;cursor:-webkit-zoom-in;cursor:-moz-zoom-in}.zoom-img,.zoom-img-wrap{position:relative;z-index:666;-webkit-transition:all .3s;-o-transition:all .3s;transition:all .3s}img.zoom-img{cursor:pointer;cursor:-webkit-zoom-out;cursor:-moz-zoom-out}.zoom-overlay{z-index:420;text-align:center;background:#fff;position:fixed;top:0;left:0;right:0;bottom:0;pointer-events:none;filter:"alpha(opacity=0)";opacity:0;-webkit-transition:opacity .3s;-o-transition:opacity .3s;transition:opacity .3s}.zoom-overlay-open .zoom-overlay{filter:"alpha(opacity=100)";opacity:1}.zoom-overlay-open,.zoom-overlay-transitioning{cursor:default}.body-wrap-zoom{width:100vw}.zoom-caption{z-index:667;bottom:10px;position:fixed;left:10px;right:10px}.zoom-initial-caption{color:#999;display:block;font-size:.9em;margin-top:.5em;position:relative;text-align:center;}</style></body></html>